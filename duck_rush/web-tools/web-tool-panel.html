<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="tool-name" content="Webå·¥å…·é¢æ¿">
    <meta name="tool-description" content="æä¾›æ ‡ç­¾é¡µç®¡ç†åŠŸèƒ½çš„ Web å·¥å…·é¢æ¿ï¼Œæ–¹ä¾¿åœ¨å¤šä¸ªå·¥å…·ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚">
    <title>Webå·¥å…·é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body, html {
            height: 100%;
            overflow: hidden;
        }

        /* æ•´ä½“å¸ƒå±€ */
        .container {
            display: flex;
            height: 100%;
        }

        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            padding: 10px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* ä¸Šä¸‹å¸ƒå±€ï¼Œè®¾ç½®å…¥å£åœ¨åº•éƒ¨ */
        }

        /* å¯¼èˆªé¡¹æ ·å¼ */
        .nav-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .nav-item {
            padding: 8px 10px;
            margin: 2px 0;
            cursor: pointer;
            border-radius: 3px;
            display: flex;
            align-items: center;
        }

        .nav-item:hover {
            background: #34495e;
        }

        .nav-item.active {
            background: #3498db;
            color: white;
        }

        /* è®¾ç½®å…¥å£æ ·å¼ */
        .settings-entry {
            padding: 8px 10px;
            margin-top: 10px;
            border-top: 1px solid #34495e;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: #bdc3c7;
        }
        
        .settings-entry:hover {
            color: white;
            background: #3498db;
            border-radius: 3px;
        }
        
        .settings-entry svg {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            fill: currentColor;
        }

        /* ä¸­é—´iframeåŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
            overflow-x: auto; /* æ”¯æŒTabæ¨ªå‘æ»šåŠ¨ */
        }

        .tab-item {
            padding: 8px 15px;
            cursor: pointer;
            border-right: 1px solid #ddd;
            display: flex;
            align-items: center;
            white-space: nowrap; /* é˜²æ­¢Tabåç§°æ¢è¡Œ */
        }

        .tab-item.active {
            background: white;
            border-top: 2px solid #3498db;
        }

        .tab-close {
            margin-left: 8px;
            font-size: 12px;
            color: #999;
            cursor: pointer;
        }

        .tab-close:hover {
            color: #e74c3c;
        }

        /* åœ°å€æ æ ·å¼ */
        .address-bar {
            padding: 8px 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn {
            padding: 6px 10px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover {
            background: #27ae60;
        }

        .refresh-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .address-input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            background: white;
            cursor: text;
        }

        .copy-btn {
            padding: 6px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn:hover {
            background: #2980b9;
        }

        .iframe-container {
            flex: 1;
            position: relative;
            overflow: hidden; /* å…³é”®ä¿®å¤ï¼šç¡®ä¿å®¹å™¨æ­£ç¡®çº¦æŸå†…éƒ¨å†…å®¹ */
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* å³ä¾§å·¥å…·æ  */
        .toolbar {
            width: 300px;
            background: #f8f9fa;
            border-left: 1px solid #ddd;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        .toolbar-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .clipboard-history {
            flex: 1;
            overflow-y: auto;
        }

        .clipboard-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            cursor: default; /* å–æ¶ˆé»˜è®¤æŒ‡é’ˆæ ·å¼ */
            word-break: break-all;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .clipboard-item:hover {
            background: #e9ecef;
        }
        
        /* å‰ªè´´æ¿å†…å®¹åŒºåŸŸ */
        .clipboard-content {
            flex: 1;
        }
        
        /* å‰ªè´´æ¿æ“ä½œæŒ‰é’® */
        .clipboard-actions {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
        }
        
        .clipboard-copy-btn {
            padding: 2px 8px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .clipboard-copy-btn:hover {
            background: #2980b9;
        }
        
        .clipboard-copy-btn.success {
            background: #27ae60;
        }
        
        /* é”™è¯¯æç¤ºæ ·å¼ */
        .iframe-error {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            color: #333;
            font-size: 16px;
        }

        /* è®¾ç½®é¡µé¢æ ·å¼ - æ ¸å¿ƒä¿®å¤ */
        .settings-page {
            padding: 20px;
            height: 100%;
            /* å…³é”®ä¿®å¤ï¼šå¯ç”¨çºµå‘æ»šåŠ¨ */
            overflow-y: auto;
            /* ä¼˜åŒ–ï¼šæ·»åŠ æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: #3498db #f1f1f1;
            background: white;
        }

        /* ä¼˜åŒ–æ»šåŠ¨æ¡æ ·å¼ï¼ˆChrome/Safariï¼‰ */
        .settings-page::-webkit-scrollbar {
            width: 6px;
        }

        .settings-page::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .settings-page::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 10px;
        }

        .settings-page::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }

        .settings-page h1 {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .settings-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .config-item {
            margin-bottom: 12px;
        }

        .settings-page label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .settings-page input {
            padding: 8px;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        /* 1. ç§»é™¤å¯¼èˆªåˆ—è¡¨çš„æ»šåŠ¨æ•ˆæœ */
        .tabs-list {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 15px; /* å¢åŠ ä¸Šè¾¹è·ï¼Œè¿œç¦»æ·»åŠ æŒ‰é’® */
            margin-bottom: 10px;
            /* ç§»é™¤max-heightå’Œoverflow-yï¼Œå–æ¶ˆæ»šåŠ¨æ•ˆæœ */
        }

        .settings-tab-item {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .settings-tab-item:last-child {
            border-bottom: none;
        }

        .tab-info {
            flex: 1;
        }

        .tab-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .tab-url {
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }

        .tab-actions {
            margin-left: 10px;
        }

        .settings-page button {
            padding: 6px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            /* ç»Ÿä¸€æŒ‰é’®é«˜åº¦ */
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .settings-page button:hover {
            background: #2980b9;
        }

        .settings-page button.btn-danger {
            background: #e74c3c;
        }

        .settings-page button.btn-danger:hover {
            background: #c0392b;
        }

        .settings-page button.btn-danger:active {
            background: #a93226;
        }

        .btn-import {
            background: #9b59b6;
        }

        .btn-import:hover {
            background: #8e44ad;
        }

        .btn-export {
            background: #f39c12;
        }

        .btn-export:hover {
            background: #e67e22;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-row > div {
            flex: 1;
        }

        .success-message {
            color: #27ae60;
            margin-top: 10px;
            display: none;
        }

        /* å¯¼å…¥å¯¼å‡ºæ ·å¼ */
        .import-export-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        #import-config-input {
            display: none;
        }

        .import-label {
            /* ç»Ÿä¸€å¯¼å…¥å¯¼å‡ºæŒ‰é’®æ ·å¼å’Œé«˜åº¦ */
            padding: 6px 12px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            box-sizing: border-box;
        }

        .import-label:hover {
            background: #8e44ad;
        }

        .config-import-notice {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Toasté€šçŸ¥æ ·å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            opacity: 0;
            transform: scale(0.95);
        }

        .toast-success {
            background: #27ae60;
        }

        .toast-error {
            background: #e74c3c;
        }

        .toast-info {
            background: #3498db;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }

        /* å¯¹è¯æ¡†æ ·å¼ */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }

        .dialog-overlay.active {
            display: flex;
        }

        .dialog {
            background: white;
            border-radius: 8px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            animation: fadeIn 0.3s ease;
        }

        .dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .dialog-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .dialog-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .dialog-close:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .dialog-content {
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§å¯¼èˆªæ ï¼ˆåŒ…å«è®¾ç½®å…¥å£ï¼‰ -->
        <div class="sidebar">
            <div class="nav-list" id="sidebar-nav"></div>
            
            <!-- å·¦ä¸‹è§’è®¾ç½®å…¥å£ -->
            <div class="settings-entry" onclick="openSettingsTab()">
                <svg viewBox="0 0 24 24">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
                <span>è®¾ç½®</span>
            </div>
        </div>

        <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <div class="tabs" id="tabs-container"></div>
            
            <!-- åœ°å€æ ï¼ˆæ–°å¢åˆ·æ–°æŒ‰é’®ï¼‰ -->
            <div class="address-bar">
                <button class="refresh-btn" id="refresh-btn" onclick="refreshCurrentTab()">
                    <svg viewBox="0 0 24 24">
                        <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                    </svg>
                </button>
                <input type="text" class="address-input" id="address-input" readonly placeholder="å½“å‰é¡µé¢URL">
                <button class="copy-btn" id="copy-btn" onclick="copyAddress()">å¤åˆ¶URL</button>
            </div>
            
            <div class="iframe-container" id="iframe-container"></div>
        </div>

        <!-- å³ä¾§å·¥å…·æ ï¼ˆä»…ä¿ç•™å‰ªè´´æ¿å†å²ï¼‰ -->
        <div class="toolbar">
            <div class="toolbar-title">å‰ªè´´æ¿å†å²</div>
            <div class="clipboard-history" id="clipboard-history"></div>
        </div>
    </div>

    <!-- Toasté€šçŸ¥å®¹å™¨ -->
    <div class="toast-container" id="toast-container"></div>

    <!-- ç¼–è¾‘åˆ†ç±»å¯¹è¯æ¡† -->
    <div class="dialog-overlay" id="edit-category-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3 class="dialog-title">ç¼–è¾‘åˆ†ç±»</h3>
                <button class="dialog-close" onclick="closeEditCategoryDialog()">Ã—</button>
            </div>
            <div class="dialog-content">
                <div class="form-group">
                    <label for="edit-category-name">åˆ†ç±»åç§°</label>
                    <input type="text" id="edit-category-name" class="form-control">
                </div>
                <div class="form-group">
                    <label for="edit-category-icon">åˆ†ç±»å›¾æ ‡</label>
                    <input type="text" id="edit-category-icon" class="form-control" placeholder="ä¾‹å¦‚ï¼šğŸ”">
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeEditCategoryDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveCategoryEdit()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å¯¼èˆªé“¾æ¥å¯¹è¯æ¡† -->
    <div class="dialog-overlay" id="edit-link-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3 class="dialog-title">ç¼–è¾‘å¯¼èˆªé“¾æ¥</h3>
                <button class="dialog-close" onclick="closeEditLinkDialog()">Ã—</button>
            </div>
            <div class="dialog-content">
                <div class="form-group">
                    <label for="edit-link-name">é“¾æ¥åç§°</label>
                    <input type="text" id="edit-link-name" class="form-control">
                </div>
                <div class="form-group">
                    <label for="edit-link-url">é“¾æ¥åœ°å€</label>
                    <input type="text" id="edit-link-url" class="form-control" placeholder="ä¾‹å¦‚ï¼šhttps://www.baidu.com">
                </div>
                <div class="form-group">
                    <label for="edit-link-category">æ‰€å±åˆ†ç±»</label>
                    <select id="edit-link-category" class="form-control"></select>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeEditLinkDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveLinkEdit()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="dialog-overlay" id="confirm-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3 class="dialog-title">ç¡®è®¤æ“ä½œ</h3>
                <button class="dialog-close" onclick="closeConfirmDialog()">Ã—</button>
            </div>
            <div class="dialog-content">
                <p id="confirm-message" style="margin: 0;"></p>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeConfirmDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="executeConfirmCallback()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ åˆ†ç±»å¯¹è¯æ¡† -->
    <div class="dialog-overlay" id="add-category-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3 class="dialog-title">æ·»åŠ åˆ†ç±»</h3>
                <button class="dialog-close" onclick="closeAddCategoryDialog()">Ã—</button>
            </div>
            <div class="dialog-content">
                <div class="form-group">
                    <label for="add-category-name">åˆ†ç±»åç§°</label>
                    <input type="text" id="add-category-name" class="form-control" placeholder="ä¾‹å¦‚ï¼šæœç´¢å¼•æ“">
                </div>
                <div class="form-group">
                    <label for="add-category-icon">åˆ†ç±»å›¾æ ‡</label>
                    <input type="text" id="add-category-icon" class="form-control" placeholder="ä¾‹å¦‚ï¼šğŸ”">
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeAddCategoryDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveNewCategory()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å¯¼èˆªé“¾æ¥å¯¹è¯æ¡† -->
    <div class="dialog-overlay" id="add-link-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3 class="dialog-title">æ·»åŠ å¯¼èˆªé“¾æ¥</h3>
                <button class="dialog-close" onclick="closeAddLinkDialog()">Ã—</button>
            </div>
            <div class="dialog-content">
                <div class="form-group">
                    <label for="add-link-name">é“¾æ¥åç§°</label>
                    <input type="text" id="add-link-name" class="form-control" placeholder="ä¾‹å¦‚ï¼šç™¾åº¦">
                </div>
                <div class="form-group">
                    <label for="add-link-url">é“¾æ¥åœ°å€</label>
                    <input type="text" id="add-link-url" class="form-control" placeholder="ä¾‹å¦‚ï¼šhttps://www.baidu.com">
                </div>
                <div class="form-group">
                    <label for="add-link-category">æ‰€å±åˆ†ç±»</label>
                    <select id="add-link-category" class="form-control"></select>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeAddLinkDialog()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveNewLink()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ========== æ ¸å¿ƒä¼˜åŒ–ï¼šåŸºäºæ–‡ä»¶åç”Ÿæˆå”¯ä¸€å­˜å‚¨å‰ç¼€ ==========
        // è·å–å½“å‰é¡µé¢æ–‡ä»¶åï¼ˆå»é™¤åç¼€ï¼‰ä½œä¸ºå”¯ä¸€æ ‡è¯†
        function getUniqueStoragePrefix() {
            // è·å–å½“å‰é¡µé¢URLçš„æ–‡ä»¶åéƒ¨åˆ†
            const path = window.location.pathname;
            const fileName = path.split('/').pop() || 'webtool_default';
            // å»é™¤æ–‡ä»¶åç¼€ï¼Œåªä¿ç•™åç§°éƒ¨åˆ†
            const fileNameWithoutExt = fileName.split('.')[0];
            // ç”Ÿæˆå®‰å…¨çš„å‰ç¼€ï¼ˆæ›¿æ¢ç‰¹æ®Šå­—ç¬¦ï¼‰
            return `webtool_${fileNameWithoutExt.replace(/[^a-zA-Z0-9_]/g, '_')}_`;
        }

        // ç”Ÿæˆå¸¦å”¯ä¸€å‰ç¼€çš„å­˜å‚¨KEY
        function getStorageKey(baseKey) {
            const prefix = getUniqueStoragePrefix();
            return `${prefix}${baseKey}`;
        }

        // é…ç½®å¸¸é‡ï¼ˆåŸºç¡€KEYï¼Œä¼šè‡ªåŠ¨æ·»åŠ å”¯ä¸€å‰ç¼€ï¼‰
        const STORAGE_BASE_KEYS = {
            NAV_LINKS: 'nav_links', // å­˜å‚¨å¯¼èˆªé“¾æ¥ï¼ˆç‹¬ç«‹äºTabï¼‰
            CATEGORIES: 'categories', // å­˜å‚¨åˆ†ç±»
            ACTIVE_TABS: 'active_tabs', // å­˜å‚¨å½“å‰æ¿€æ´»çš„Tab
            CLIPBOARD: 'clipboard',
            CONFIG: 'config'
        };

        // 3. Schemaç‰ˆæœ¬å¸¸é‡
        const SCHEMA_CONSTANTS = {
            CURRENT_VERSION: '1.0', // å½“å‰schemaç‰ˆæœ¬
            SUPPORTED_VERSIONS: ['1.0'] // æ”¯æŒçš„schemaç‰ˆæœ¬åˆ—è¡¨
        };

        // è®¾ç½®Tabçš„å›ºå®šID
        const SETTINGS_TAB_ID = 'settings_tab';

        // é»˜è®¤é…ç½®
        const DEFAULT_CONFIG = {
            clipboardLimit: 100
        };

        // é»˜è®¤åˆ†ç±»
        const DEFAULT_CATEGORIES = [
            { id: 'cat1', name: 'æœç´¢å¼•æ“', icon: 'ğŸ”' },
            { id: 'cat2', name: 'å¼€å‘ç¤¾åŒº', icon: 'ğŸ’»' },
            { id: 'cat3', name: 'å…¶ä»–å·¥å…·', icon: 'ğŸ“' }
        ];

        // é»˜è®¤å¯¼èˆªé“¾æ¥
        const DEFAULT_NAV_LINKS = [
            { id: 'nav1', name: 'ç™¾åº¦', url: 'https://www.baidu.com', categoryId: 'cat1' },
            { id: 'nav2', name: 'è°·æ­Œ', url: 'https://www.google.com', categoryId: 'cat1' },
            { id: 'nav-bing', name: 'Bing', url: 'https://cn.bing.com/', categoryId: 'cat1' },
            { id: 'nav3', name: 'æ˜é‡‘', url: 'https://juejin.cn', categoryId: 'cat2' }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½é…ç½®
            loadConfig();
            // åŠ è½½åˆ†ç±»
            loadCategories();
            // åŠ è½½å¯¼èˆªé“¾æ¥
            loadNavLinks();
            // åˆå§‹åŒ–æ¿€æ´»çš„Tabsï¼ˆé»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªå¯¼èˆªé“¾æ¥ï¼‰
            initActiveTabs();
            // æ¸²æŸ“Tabs
            renderTabs(Array.from(window.activeTabs.keys()).length > 0 ? Array.from(window.activeTabs.keys())[0] : null);
            // æ¸²æŸ“å·¦ä¾§å¯¼èˆª
            renderSidebarNav();
            // åŠ è½½å‰ªè´´æ¿å†å²
            loadClipboardHistory();
            // ç›‘å¬å‰ªè´´æ¿
            listenClipboard();
            
            // ç»‘å®šå¯¼å…¥é…ç½®äº‹ä»¶
            document.getElementById('import-config-input').addEventListener('change', handleConfigImport);
        });

        // åŠ è½½é…ç½®
        function loadConfig() {
            const savedConfig = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CONFIG)) || '{}');
            window.appConfig = { ...DEFAULT_CONFIG, ...savedConfig };
        }

        // åŠ è½½åˆ†ç±»ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰
        function loadCategories() {
            const savedCategories = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CATEGORIES)) || '[]');
            window.categories = savedCategories.length > 0 ? savedCategories : DEFAULT_CATEGORIES;
        }

        // ä¿å­˜åˆ†ç±»
        function saveCategories() {
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.CATEGORIES), JSON.stringify(window.categories));
        }

        // åŠ è½½å¯¼èˆªé“¾æ¥ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰
        function loadNavLinks() {
            const savedNavLinks = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.NAV_LINKS)) || '[]');
            window.navLinks = savedNavLinks.length > 0 ? savedNavLinks : DEFAULT_NAV_LINKS;
            
            // åˆå§‹åŒ–æ¿€æ´»çš„Tabsé›†åˆï¼ˆç”¨äºç®¡ç†å½“å‰æ‰“å¼€çš„Tabï¼‰
            window.activeTabs = new Map();
        }

        // åˆå§‹åŒ–æ¿€æ´»çš„Tabs
        function initActiveTabs() {
            const savedActiveTabs = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.ACTIVE_TABS)) || '{}');
            
            // å¦‚æœæœ‰ä¿å­˜çš„æ¿€æ´»Tabsï¼Œæ¢å¤ï¼›å¦åˆ™é»˜è®¤æ‰“å¼€ç¬¬ä¸€ä¸ªå¯¼èˆªé“¾æ¥
            if (Object.keys(savedActiveTabs).length > 0) {
                for (const [navId, tabData] of Object.entries(savedActiveTabs)) {
                    window.activeTabs.set(navId, tabData);
                }
            } else if (window.navLinks.length > 0) {
                const firstNav = window.navLinks[0];
                window.activeTabs.set(firstNav.id, {
                    name: firstNav.name,
                    url: firstNav.url,
                    id: firstNav.id
                });
            }
            
            // ä¿å­˜æ¿€æ´»çš„Tabs
            saveActiveTabs();
        }

        // ä¿å­˜å¯¼èˆªé“¾æ¥ï¼ˆä»…è®¾ç½®é¡µé¢å¯è°ƒç”¨ï¼‰
        function saveNavLinks() {
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.NAV_LINKS), JSON.stringify(window.navLinks));
        }

        // ä¿å­˜æ¿€æ´»çš„Tabs
        function saveActiveTabs() {
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.ACTIVE_TABS), JSON.stringify(Object.fromEntries(window.activeTabs)));
        }

        // æ¸²æŸ“Tabs
        function renderTabs(keepActiveTabId = null) {
            const tabsContainer = document.getElementById('tabs-container');
            const iframeContainer = document.getElementById('iframe-container');
            
            // æ¸…ç©ºå®¹å™¨
            tabsContainer.innerHTML = '';
            iframeContainer.innerHTML = '';

            // æ¸²æŸ“æ¿€æ´»çš„Tabs
            const activeTabIds = Array.from(window.activeTabs.keys());
            activeTabIds.forEach((navId, index) => {
                const tabData = window.activeTabs.get(navId);
                const isActive = keepActiveTabId ? (navId === keepActiveTabId) : (index === 0);
                renderSingleTab(navId, tabData, isActive);
            });
            
            // ä¸ºæ‰€æœ‰iframeæ·»åŠ å‰ªè´´æ¿ç›‘å¬
            setupIframeClipboardListeners();

            // æ¸²æŸ“è®¾ç½®Tabï¼ˆå›ºå®šåœ¨æœ€åï¼‰
            renderSettingsTab(keepActiveTabId === SETTINGS_TAB_ID);

            // å¦‚æœæœ‰æŒ‡å®šä¿æŒæ¿€æ´»çš„Tabï¼Œåˆ‡æ¢åˆ°è¯¥Tabï¼›å¦åˆ™é»˜è®¤æ¿€æ´»ç¬¬ä¸€ä¸ª
            if (keepActiveTabId) {
                switchTab(keepActiveTabId, false);
            } else if (activeTabIds.length > 0) {
                switchTab(activeTabIds[0]);
            }
        }

        // æ¸²æŸ“å•ä¸ªTab
        function renderSingleTab(navId, tabData, isActive) {
            const tabsContainer = document.getElementById('tabs-container');
            const iframeContainer = document.getElementById('iframe-container');

            // åˆ›å»ºTabé¡¹
            const tabItem = document.createElement('div');
            tabItem.className = `tab-item ${isActive ? 'active' : ''}`;
            tabItem.dataset.tabId = navId;
            tabItem.innerHTML = `
                ${tabData.name}
                <span class="tab-close" data-tab-id="${navId}">Ã—</span>
            `;
            
            // Tabç‚¹å‡»äº‹ä»¶
            tabItem.addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-close')) return;
                switchTab(navId);
            });
            
            // å…³é—­æŒ‰é’®äº‹ä»¶ï¼ˆä»…ç§»é™¤Tabï¼Œä¸åˆ é™¤å¯¼èˆªé“¾æ¥ï¼‰
            tabItem.querySelector('.tab-close').addEventListener('click', function(e) {
                e.stopPropagation();
                closeTab(navId);
            });
            
            tabsContainer.appendChild(tabItem);

            // åˆ›å»ºå¯¹åº”çš„iframe
            const iframe = document.createElement('iframe');
            iframe.id = `iframe-${navId}`;
            iframe.src = tabData.url;
            iframe.style.display = isActive ? 'block' : 'none';
            
            // æ·»åŠ iframeåŠ è½½å¤±è´¥å¤„ç†
            iframe.addEventListener('error', function() {
                const errorContainer = document.createElement('div');
                errorContainer.className = 'iframe-error';
                errorContainer.innerHTML = `
                    <div style="margin-bottom: 10px; font-size: 24px; color: #e74c3c;">âš ï¸</div>
                    <div>æ— æ³•åŠ è½½ "${tabData.name}"</div>
                    <div style="font-size: 14px; color: #666; margin-top: 8px;">è¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®æˆ–ç½‘ç»œè¿æ¥</div>
                    <button style="margin-top: 20px;" onclick="window.open('${tabData.url}', '_blank')">åœ¨æ–°çª—å£æ‰“å¼€</button>
                `;
                iframeContainer.appendChild(errorContainer);
                iframe.style.display = 'none';
            });

            // iframeåŠ è½½å®Œæˆåæ›´æ–°åœ°å€æ 
            iframe.addEventListener('load', function() {
                if (document.querySelector(`.tab-item[data-tab-id="${navId}"].active`)) {
                    updateAddressBar(tabData.url);
                }
                
                // ä¸ºiframeæ·»åŠ å‰ªè´´æ¿ç›‘å¬
                try {
                    iframe.contentDocument.addEventListener('paste', function(e) {
                        const clipboardData = e.clipboardData || window.clipboardData;
                        const text = clipboardData.getData('text');
                        
                        if (text) {
                            addToClipboardHistory(text);
                        }
                    });
                } catch (error) {
                    // å¿½ç•¥è·¨åŸŸiframeçš„é”™è¯¯
                    console.log('æ— æ³•ä¸ºiframeæ·»åŠ å‰ªè´´æ¿ç›‘å¬:', error.message);
                }
            });
            
            iframeContainer.appendChild(iframe);
        }

        // æ¸²æŸ“è®¾ç½®Tabï¼ˆæ–°å¢å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ï¼‰
        function renderSettingsTab(isActive) {
            const tabsContainer = document.getElementById('tabs-container');
            const iframeContainer = document.getElementById('iframe-container');

            // åˆ›å»ºè®¾ç½®Tabé¡¹
            const tabItem = document.createElement('div');
            tabItem.className = `tab-item ${isActive ? 'active' : ''}`;
            tabItem.dataset.tabId = SETTINGS_TAB_ID;
            tabItem.innerHTML = `
                è®¾ç½®
                <span class="tab-close" data-tab-id="${SETTINGS_TAB_ID}" style="display:none">Ã—</span>
            `;
            
            // Tabç‚¹å‡»äº‹ä»¶
            tabItem.addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-close')) return;
                switchTab(SETTINGS_TAB_ID);
            });
            
            tabsContainer.appendChild(tabItem);

            // åˆ›å»ºè®¾ç½®é¡µé¢å®¹å™¨
            const settingsContainer = document.createElement('div');
            settingsContainer.id = `iframe-${SETTINGS_TAB_ID}`;
            settingsContainer.className = 'settings-page';
            settingsContainer.style.display = isActive ? 'block' : 'none';
            
            // è®¾ç½®é¡µé¢å†…å®¹ï¼ˆæ–°å¢å¯¼å…¥å¯¼å‡ºåŒºåŸŸï¼‰
            settingsContainer.innerHTML = `
                <h1>Webå·¥å…·é¢æ¿è®¾ç½®</h1>

                <!-- å‰ªè´´æ¿è®¾ç½® -->
                <div class="settings-section">
                    <div class="settings-title">å‰ªè´´æ¿è®¾ç½®</div>
                    <div class="config-item">
                        <label for="settings-clipboard-limit">å‰ªè´´æ¿æœ€å¤§ä¿å­˜æ¡æ•°</label>
                        <input type="number" id="settings-clipboard-limit" min="1" max="500" value="${window.appConfig.clipboardLimit}">
                    </div>
                </div>

                <!-- åˆ†ç±»ç®¡ç† -->
                <div class="settings-section">
                    <div class="settings-title">åˆ†ç±»ç®¡ç†</div>
                    
                    <button onclick="openAddCategoryDialog()">æ·»åŠ åˆ†ç±»</button>

                    <!-- åˆ†ç±»åˆ—è¡¨ -->
                    <div class="tabs-list" id="settings-category-list"></div>
                </div>

                <!-- å¯¼èˆªé“¾æ¥ç®¡ç† -->
                <div class="settings-section">
                    <div class="settings-title">å¯¼èˆªé“¾æ¥ç®¡ç†</div>
                    
                    <button onclick="openAddLinkDialog()">æ·»åŠ å¯¼èˆª</button>

                    <!-- å¯¼èˆªé“¾æ¥åˆ—è¡¨ - å·²ç§»é™¤æ»šåŠ¨æ•ˆæœ -->
                    <div class="tabs-list" id="settings-nav-list"></div>
                </div>

                <!-- é…ç½®å¯¼å…¥å¯¼å‡º -->
                <div class="settings-section">
                    <div class="settings-title">é…ç½®å¯¼å…¥å¯¼å‡º</div>
                    <p style="margin-bottom: 10px; font-size: 14px; color: #666;">
                        å¯å¤‡ä»½/æ¢å¤å¯¼èˆªé“¾æ¥å’Œå‰ªè´´æ¿é…ç½®ï¼Œæ–¹ä¾¿è¿ç§»æˆ–å¤‡ä»½è®¾ç½®
                    </p>
                    
                    <div class="import-export-group">
                        <label for="import-config-input" class="import-label">å¯¼å…¥é…ç½®</label>
                        <input type="file" id="import-config-input" accept=".json">
                        <button class="btn-export" onclick="exportConfig()">å¯¼å‡ºé…ç½®</button>
                    </div>
                    
                    <div class="config-import-notice">
                        âš ï¸ å¯¼å…¥é…ç½®ä¼šè¦†ç›–å½“å‰æ‰€æœ‰å¯¼èˆªé“¾æ¥å’Œå‰ªè´´æ¿è®¾ç½®ï¼Œè¯·è°¨æ…æ“ä½œï¼
                    </div>
                </div>

                <!-- ä¿å­˜æŒ‰é’® -->
                <div class="btn-group">
                    <button onclick="saveSettings()">ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
                </div>

                <div class="success-message" id="settings-success-message">è®¾ç½®ä¿å­˜æˆåŠŸï¼</div>
            `;
            
            iframeContainer.appendChild(settingsContainer);

            // æ¸²æŸ“è®¾ç½®é¡µé¢ä¸­çš„åˆ†ç±»åˆ—è¡¨å’Œå¯¼èˆªåˆ—è¡¨
            renderSettingsCategoryList();
            updateCategorySelector();
            renderSettingsNavList();
        }

        // åˆ‡æ¢Tab
        function switchTab(tabId, updateNav = true) {
            // æ›´æ–°Tabæ ·å¼
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.toggle('active', item.dataset.tabId === tabId);
            });

            // æ›´æ–°å·¦ä¾§å¯¼èˆªæ¿€æ´»çŠ¶æ€ï¼ˆå¯æ§åˆ¶æ˜¯å¦æ›´æ–°ï¼‰
            if (updateNav && tabId !== SETTINGS_TAB_ID) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.navId === tabId);
                });
            }

            // éšè—æ‰€æœ‰é”™è¯¯æç¤º
            document.querySelectorAll('.iframe-error').forEach(el => {
                el.style.display = 'none';
            });

            // æ›´æ–°iframe/è®¾ç½®é¡µé¢æ˜¾ç¤º
            document.querySelectorAll('.iframe-container > *').forEach(el => {
                el.style.display = el.id === `iframe-${tabId}` ? 'block' : 'none';
            });

            // æ›´æ–°åœ°å€æ 
            if (tabId === SETTINGS_TAB_ID) {
                updateAddressBar('è®¾ç½®é¡µé¢');
            } else {
                const navLink = window.navLinks.find(n => n.id === tabId);
                if (navLink) {
                    updateAddressBar(navLink.url);
                }
            }
        }

        // åˆ·æ–°å½“å‰Tabé¡µ
        function refreshCurrentTab() {
            // è·å–å½“å‰æ¿€æ´»çš„Tab ID
            const activeTabElement = document.querySelector('.tab-item.active');
            if (!activeTabElement) return;
            
            const tabId = activeTabElement.dataset.tabId;
            
            // è·³è¿‡è®¾ç½®é¡µé¢
            if (tabId === SETTINGS_TAB_ID) return;
            
            // æ‰¾åˆ°å¯¹åº”çš„iframeå¹¶åˆ·æ–°
            const iframe = document.getElementById(`iframe-${tabId}`);
            if (iframe) {
                iframe.src = iframe.src; // åˆ·æ–°iframe
                
                // æŒ‰é’®åŠ¨ç”»åé¦ˆ
                const refreshBtn = document.getElementById('refresh-btn');
                refreshBtn.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    refreshBtn.style.transform = 'rotate(0deg)';
                }, 500);
            }
        }

        // æ›´æ–°åœ°å€æ 
        function updateAddressBar(url) {
            const addressInput = document.getElementById('address-input');
            addressInput.value = url || '';
        }

        // å¤åˆ¶åœ°å€æ URL
        function copyAddress() {
            const addressInput = document.getElementById('address-input');
            const copyBtn = document.getElementById('copy-btn');
            
            // ä¸´æ—¶å–æ¶ˆåªè¯»ï¼Œå¤åˆ¶åæ¢å¤
            addressInput.readOnly = false;
            addressInput.select();
            document.execCommand('copy');
            addressInput.readOnly = true;
            
            // æç¤ºå¤åˆ¶æˆåŠŸ
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 1000);
        }

        // è·å–åˆ†ç±»å±•å¼€çŠ¶æ€
        function getCategoryExpandedState(categoryId) {
            const expandedStates = JSON.parse(localStorage.getItem(getStorageKey('category_expanded_states')) || '{}');
            return expandedStates[categoryId] !== false; // é»˜è®¤å±•å¼€
        }

        // ä¿å­˜åˆ†ç±»å±•å¼€çŠ¶æ€
        function saveCategoryExpandedState(categoryId, expanded) {
            const expandedStates = JSON.parse(localStorage.getItem(getStorageKey('category_expanded_states')) || '{}');
            expandedStates[categoryId] = expanded;
            localStorage.setItem(getStorageKey('category_expanded_states'), JSON.stringify(expandedStates));
        }

        // æ¸²æŸ“å·¦ä¾§å¯¼èˆª
        function renderSidebarNav() {
            const sidebarNav = document.getElementById('sidebar-nav');
            sidebarNav.innerHTML = '';

            // æŒ‰åˆ†ç±»ç»„ç»‡å¯¼èˆªé“¾æ¥
            const linksByCategory = {};
            window.navLinks.forEach(navLink => {
                const categoryId = navLink.categoryId || 'uncategorized';
                if (!linksByCategory[categoryId]) {
                    linksByCategory[categoryId] = [];
                }
                linksByCategory[categoryId].push(navLink);
            });

            // ç”Ÿæˆåˆ†ç±»å¯¼èˆª
            window.categories.forEach(category => {
                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                // è·å–åˆ†ç±»å±•å¼€çŠ¶æ€
                const isExpanded = getCategoryExpandedState(category.id);
                
                categoryHeader.innerHTML = `
                    <div style="display: flex; align-items: center; padding: 8px 10px; font-weight: bold; color: #bdc3c7; cursor: pointer;" data-category-id="${category.id}">
                        <span class="collapse-icon" style="margin-right: 8px; width: 16px; text-align: center;">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                        <span style="margin-right: 8px;">${category.icon}</span>
                        <span>${category.name}</span>
                    </div>
                `;
                
                // æ·»åŠ åˆ†ç±»é“¾æ¥å®¹å™¨
                const categoryLinksContainer = document.createElement('div');
                categoryLinksContainer.className = 'category-links';
                categoryLinksContainer.style.display = isExpanded ? 'block' : 'none';
                
                // ç”Ÿæˆè¯¥åˆ†ç±»ä¸‹çš„å¯¼èˆªé“¾æ¥
                const categoryLinks = linksByCategory[category.id] || [];
                categoryLinks.forEach(navLink => {
                    const navItem = document.createElement('div');
                    navItem.className = `nav-item ${Array.from(window.activeTabs.keys()).includes(navLink.id) && document.querySelector(`.tab-item[data-tab-id="${navLink.id}"].active`) ? 'active' : ''}`;
                    navItem.dataset.navId = navLink.id;
                    navItem.innerHTML = `<span style="margin-left: 36px;">${navLink.name}</span>`;
                    
                    // ç‚¹å‡»å¯¼èˆªé¡¹æ‰“å¼€/åˆ‡æ¢Tab
                    navItem.addEventListener('click', function() {
                        const navId = this.dataset.navId;
                        
                        // å¦‚æœè¯¥å¯¼èˆªé“¾æ¥è¿˜æ²¡æ‰“å¼€ï¼Œæ·»åŠ åˆ°æ¿€æ´»Tabs
                        if (!window.activeTabs.has(navId)) {
                            window.activeTabs.set(navId, {
                                name: navLink.name,
                                url: navLink.url,
                                id: navId
                            });
                            saveActiveTabs();
                            renderTabs(navId);
                        }
                        
                        // åˆ‡æ¢åˆ°è¯¥Tab
                        switchTab(navId);
                    });
                    
                    categoryLinksContainer.appendChild(navItem);
                });
                
                // æ·»åŠ åˆ†ç±»æ ‡é¢˜ç‚¹å‡»äº‹ä»¶
                const headerDiv = categoryHeader.querySelector('div[data-category-id]');
                headerDiv.addEventListener('click', function() {
                    const categoryId = this.dataset.categoryId;
                    const isExpanded = getCategoryExpandedState(categoryId);
                    const newExpandedState = !isExpanded;
                    
                    // æ›´æ–°å±•å¼€çŠ¶æ€
                    saveCategoryExpandedState(categoryId, newExpandedState);
                    
                    // æ›´æ–°å›¾æ ‡å’Œé“¾æ¥å®¹å™¨æ˜¾ç¤º
                    const collapseIcon = this.querySelector('.collapse-icon');
                    collapseIcon.textContent = newExpandedState ? 'â–¼' : 'â–¶';
                    
                    const linksContainer = this.parentElement.nextElementSibling;
                    linksContainer.style.display = newExpandedState ? 'block' : 'none';
                });
                
                sidebarNav.appendChild(categoryHeader);
                sidebarNav.appendChild(categoryLinksContainer);
            });

            // å¤„ç†æœªåˆ†ç±»çš„é“¾æ¥
            const uncategorizedLinks = linksByCategory['uncategorized'] || [];
            if (uncategorizedLinks.length > 0) {
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                // è·å–æœªåˆ†ç±»çš„å±•å¼€çŠ¶æ€
                const isExpanded = getCategoryExpandedState('uncategorized');
                
                categoryHeader.innerHTML = `
                    <div style="display: flex; align-items: center; padding: 8px 10px; font-weight: bold; color: #bdc3c7; cursor: pointer;" data-category-id="uncategorized">
                        <span class="collapse-icon" style="margin-right: 8px; width: 16px; text-align: center;">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                        <span style="margin-right: 8px;">ğŸ“</span>
                        <span>æœªåˆ†ç±»</span>
                    </div>
                `;
                
                // æ·»åŠ åˆ†ç±»é“¾æ¥å®¹å™¨
                const categoryLinksContainer = document.createElement('div');
                categoryLinksContainer.className = 'category-links';
                categoryLinksContainer.style.display = isExpanded ? 'block' : 'none';
                
                uncategorizedLinks.forEach(navLink => {
                    const navItem = document.createElement('div');
                    navItem.className = `nav-item ${Array.from(window.activeTabs.keys()).includes(navLink.id) && document.querySelector(`.tab-item[data-tab-id="${navLink.id}"].active`) ? 'active' : ''}`;
                    navItem.dataset.navId = navLink.id;
                    navItem.innerHTML = `<span style="margin-left: 36px;">${navLink.name}</span>`;
                    
                    // ç‚¹å‡»å¯¼èˆªé¡¹æ‰“å¼€/åˆ‡æ¢Tab
                    navItem.addEventListener('click', function() {
                        const navId = this.dataset.navId;
                        
                        // å¦‚æœè¯¥å¯¼èˆªé“¾æ¥è¿˜æ²¡æ‰“å¼€ï¼Œæ·»åŠ åˆ°æ¿€æ´»Tabs
                        if (!window.activeTabs.has(navId)) {
                            window.activeTabs.set(navId, {
                                name: navLink.name,
                                url: navLink.url,
                                id: navId
                            });
                            saveActiveTabs();
                            renderTabs(navId);
                        }
                        
                        // åˆ‡æ¢åˆ°è¯¥Tab
                        switchTab(navId);
                    });
                    
                    categoryLinksContainer.appendChild(navItem);
                });
                
                // æ·»åŠ åˆ†ç±»æ ‡é¢˜ç‚¹å‡»äº‹ä»¶
                const headerDiv = categoryHeader.querySelector('div[data-category-id]');
                headerDiv.addEventListener('click', function() {
                    const categoryId = this.dataset.categoryId;
                    const isExpanded = getCategoryExpandedState(categoryId);
                    const newExpandedState = !isExpanded;
                    
                    // æ›´æ–°å±•å¼€çŠ¶æ€
                    saveCategoryExpandedState(categoryId, newExpandedState);
                    
                    // æ›´æ–°å›¾æ ‡å’Œé“¾æ¥å®¹å™¨æ˜¾ç¤º
                    const collapseIcon = this.querySelector('.collapse-icon');
                    collapseIcon.textContent = newExpandedState ? 'â–¼' : 'â–¶';
                    
                    const linksContainer = this.parentElement.nextElementSibling;
                    linksContainer.style.display = newExpandedState ? 'block' : 'none';
                });
                
                sidebarNav.appendChild(categoryHeader);
                sidebarNav.appendChild(categoryLinksContainer);
            }
        }

        // æ‰“å¼€è®¾ç½®Tab
        function openSettingsTab() {
            switchTab(SETTINGS_TAB_ID);
            // é‡æ–°æ¸²æŸ“è®¾ç½®é¡µé¢çš„åˆ†ç±»åˆ—è¡¨å’Œå¯¼èˆªåˆ—è¡¨
            renderSettingsCategoryList();
            updateCategorySelector();
            renderSettingsNavList();
        }

        // å…³é—­Tabï¼ˆä»…ç§»é™¤æ¿€æ´»çŠ¶æ€ï¼Œä¸åˆ é™¤å¯¼èˆªé“¾æ¥ï¼‰
        function closeTab(navId) {
            // ä¸èƒ½å…³é—­è®¾ç½®Tab
            if (navId === SETTINGS_TAB_ID) return;
            
            // è‡³å°‘ä¿ç•™ä¸€ä¸ªæ‰“å¼€çš„Tab
            if (window.activeTabs.size <= 1) {
                showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªæ‰“å¼€çš„Tabé¡µï¼', 'error');
                return;
            }

            // ä»æ¿€æ´»Tabsä¸­ç§»é™¤
            window.activeTabs.delete(navId);
            saveActiveTabs();
            
            // ç¡®å®šæ–°çš„æ¿€æ´»Tabï¼ˆå¦‚æœå…³é—­çš„æ˜¯å½“å‰æ¿€æ´»çš„Tabï¼‰
            const isActive = document.querySelector(`.tab-item[data-tab-id="${navId}"].active`) !== null;
            const newActiveTabId = isActive ? Array.from(window.activeTabs.keys())[0] : document.querySelector('.tab-item.active')?.dataset.tabId || Array.from(window.activeTabs.keys())[0];
            
            // é‡æ–°æ¸²æŸ“Tabs
            renderTabs(newActiveTabId);
            renderSidebarNav();
        }

        // ========== è®¾ç½®é¡µé¢ç›¸å…³å‡½æ•° ==========
        // æ¸²æŸ“è®¾ç½®é¡µé¢çš„åˆ†ç±»åˆ—è¡¨
        function renderSettingsCategoryList() {
            const categoryList = document.getElementById('settings-category-list');
            if (!categoryList) return;
            
            categoryList.innerHTML = '';

            if (window.categories.length === 0) {
                categoryList.innerHTML = '<div style="padding: 10px; text-align: center; color: #999;">æš‚æ— åˆ†ç±»</div>';
                return;
            }

            // æ¸²æŸ“æ¯ä¸ªåˆ†ç±»é¡¹
            window.categories.forEach(category => {
                // è®¡ç®—è¯¥åˆ†ç±»ä¸‹çš„é“¾æ¥æ•°é‡
                const linkCount = window.navLinks.filter(link => link.categoryId === category.id).length;
                
                const categoryItem = document.createElement('div');
                categoryItem.className = 'settings-tab-item';
                categoryItem.innerHTML = `
                    <div class="tab-info">
                        <div class="tab-name">${category.icon} ${category.name} (${linkCount}ä¸ªé“¾æ¥)</div>
                    </div>
                    <div class="tab-actions">
                        <button onclick="editCategory('${category.id}')">ç¼–è¾‘</button>
                        <button class="btn-danger" onclick="deleteCategory('${category.id}')">åˆ é™¤</button>
                    </div>
                `;
                categoryList.appendChild(categoryItem);
            });
        }

        // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
        function updateCategorySelector() {
            const categorySelector = document.getElementById('settings-nav-category');
            if (!categorySelector) return;
            
            categorySelector.innerHTML = '';
            
            // æ·»åŠ é»˜è®¤é€‰é¡¹
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'é€‰æ‹©åˆ†ç±»';
            categorySelector.appendChild(defaultOption);
            
            // æ·»åŠ åˆ†ç±»é€‰é¡¹
            window.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.icon} ${category.name}`;
                categorySelector.appendChild(option);
            });
        }

        // æ¸²æŸ“è®¾ç½®é¡µé¢çš„å¯¼èˆªåˆ—è¡¨
        function renderSettingsNavList() {
            const navList = document.getElementById('settings-nav-list');
            if (!navList) return;
            
            navList.innerHTML = '';

            if (window.navLinks.length === 0) {
                navList.innerHTML = '<div style="padding: 10px; text-align: center; color: #999;">æš‚æ— å¯¼èˆªé“¾æ¥</div>';
                return;
            }

            // æ¸²æŸ“æ¯ä¸ªå¯¼èˆªé¡¹
            window.navLinks.forEach(navLink => {
                // è·å–åˆ†ç±»åç§°
                const category = window.categories.find(cat => cat.id === navLink.categoryId);
                const categoryName = category ? `${category.icon} ${category.name}` : 'æœªåˆ†ç±»';
                
                const navItem = document.createElement('div');
                navItem.className = 'settings-tab-item';
                navItem.innerHTML = `
                    <div class="tab-info">
                        <div class="tab-name">${navLink.name}</div>
                        <div class="tab-url">${navLink.url}</div>
                        <div style="font-size: 12px; color: #999; margin-top: 4px;">åˆ†ç±»: ${categoryName}</div>
                    </div>
                    <div class="tab-actions">
                        <button onclick="editNavLink('${navLink.id}')">ç¼–è¾‘</button>
                        <button class="btn-danger" onclick="removeNavLink('${navLink.id}')">åˆ é™¤</button>
                    </div>
                `;
                navList.appendChild(navItem);
            });
        }

        // æ·»åŠ æ–°å¯¼èˆªé“¾æ¥ï¼ˆä»…è®¾ç½®é¡µé¢å¯æ“ä½œï¼‰
        function addNewNavLink() {
            const navName = document.getElementById('settings-nav-name').value.trim();
            const navUrl = document.getElementById('settings-nav-url').value.trim();
            const categoryId = document.getElementById('settings-nav-category').value;
            
            if (!navName || !navUrl) {
                showToast('è¯·è¾“å…¥å¯¼èˆªåç§°å’Œé“¾æ¥ï¼', 'error');
                return;
            }

            // ç”Ÿæˆå”¯ä¸€ID
            const navId = 'nav_' + Date.now();
            
            // æ·»åŠ åˆ°å¯¼èˆªé“¾æ¥
            const newNavLink = {
                id: navId,
                name: navName,
                url: navUrl
            };
            
            // æ·»åŠ åˆ†ç±»ä¿¡æ¯ï¼ˆå¦‚æœé€‰æ‹©äº†åˆ†ç±»ï¼‰
            if (categoryId) {
                newNavLink.categoryId = categoryId;
            }
            
            window.navLinks.push(newNavLink);

            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveNavLinks();
            renderSidebarNav();
            renderSettingsNavList();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('settings-nav-name').value = '';
            document.getElementById('settings-nav-url').value = '';
            document.getElementById('settings-nav-category').value = '';
            
            showToast('å¯¼èˆªé“¾æ¥æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // åˆ é™¤å¯¼èˆªé“¾æ¥ï¼ˆä»…è®¾ç½®é¡µé¢å¯æ“ä½œï¼‰
        function removeNavLink(navId) {
            // è‡³å°‘ä¿ç•™ä¸€ä¸ªå¯¼èˆªé“¾æ¥
            if (window.navLinks.length <= 1) {
                showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªå¯¼èˆªé“¾æ¥ï¼', 'error');
                return;
            }

            // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            showConfirmDialog(
                'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¼èˆªé“¾æ¥å—ï¼Ÿå·²æ‰“å¼€çš„ç›¸å…³Tabä¹Ÿä¼šè¢«å…³é—­',
                function() {
                    // ä»å¯¼èˆªé“¾æ¥ä¸­ç§»é™¤
                    window.navLinks = window.navLinks.filter(nav => nav.id !== navId);
                    
                    // å¦‚æœè¯¥å¯¼èˆªæœ‰æ‰“å¼€çš„Tabï¼ŒåŒæ—¶å…³é—­
                    window.activeTabs.delete(navId);
                    saveActiveTabs();
                    
                    // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
                    saveNavLinks();
                    renderSidebarNav();
                    renderSettingsNavList();
                    
                    // é‡æ–°æ¸²æŸ“Tabsï¼ˆä¿æŒåœ¨è®¾ç½®é¡µé¢ï¼‰
                    renderTabs(SETTINGS_TAB_ID);
                    
                    showToast('å¯¼èˆªé“¾æ¥åˆ é™¤æˆåŠŸï¼', 'success');
                }
            );
        }

        // æ·»åŠ æ–°åˆ†ç±»
        function addNewCategory() {
            const categoryName = document.getElementById('settings-category-name').value.trim();
            const categoryIcon = document.getElementById('settings-category-icon').value.trim();
            
            if (!categoryName) {
                showToast('è¯·è¾“å…¥åˆ†ç±»åç§°ï¼', 'error');
                return;
            }

            // ç”Ÿæˆå”¯ä¸€ID
            const categoryId = 'cat_' + Date.now();
            
            // æ·»åŠ åˆ°åˆ†ç±»åˆ—è¡¨
            window.categories.push({
                id: categoryId,
                name: categoryName,
                icon: categoryIcon || 'ğŸ“'
            });

            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveCategories();
            renderSidebarNav();
            renderSettingsCategoryList();
            updateCategorySelector();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('settings-category-name').value = '';
            document.getElementById('settings-category-icon').value = '';
            
            showToast('åˆ†ç±»æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨å½“å‰æ­£åœ¨ç¼–è¾‘çš„åˆ†ç±»å’Œé“¾æ¥ID
        let currentEditingCategoryId = null;
        let currentEditingLinkId = null;
        let confirmDialogCallback = null;

        // ç¼–è¾‘åˆ†ç±»
        function editCategory(categoryId) {
            const category = window.categories.find(cat => cat.id === categoryId);
            if (!category) return;
            
            // å­˜å‚¨å½“å‰ç¼–è¾‘çš„åˆ†ç±»ID
            currentEditingCategoryId = categoryId;
            
            // å¡«å……å¯¹è¯æ¡†è¡¨å•
            document.getElementById('edit-category-name').value = category.name;
            document.getElementById('edit-category-icon').value = category.icon;
            
            // æ˜¾ç¤ºå¯¹è¯æ¡†
            document.getElementById('edit-category-dialog').classList.add('active');
        }

        // å…³é—­ç¼–è¾‘åˆ†ç±»å¯¹è¯æ¡†
        function closeEditCategoryDialog() {
            // æ¸…ç©ºå½“å‰ç¼–è¾‘çš„åˆ†ç±»ID
            currentEditingCategoryId = null;
            
            // éšè—å¯¹è¯æ¡†
            document.getElementById('edit-category-dialog').classList.remove('active');
        }

        // ä¿å­˜åˆ†ç±»ç¼–è¾‘
        function saveCategoryEdit() {
            if (!currentEditingCategoryId) return;
            
            const category = window.categories.find(cat => cat.id === currentEditingCategoryId);
            if (!category) {
                closeEditCategoryDialog();
                return;
            }
            
            const newName = document.getElementById('edit-category-name').value.trim();
            const newIcon = document.getElementById('edit-category-icon').value.trim();
            
            if (!newName) {
                showToast('åˆ†ç±»åç§°ä¸èƒ½ä¸ºç©ºï¼', 'error');
                return;
            }
            
            // æ›´æ–°åˆ†ç±»ä¿¡æ¯
            category.name = newName;
            category.icon = newIcon || 'ğŸ“';
            
            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveCategories();
            renderSidebarNav();
            renderSettingsCategoryList();
            updateCategorySelector();
            
            // å…³é—­å¯¹è¯æ¡†
            closeEditCategoryDialog();
            
            showToast('åˆ†ç±»ç¼–è¾‘æˆåŠŸï¼', 'success');
        }

        // ç¼–è¾‘å¯¼èˆªé“¾æ¥
        function editNavLink(navId) {
            const navLink = window.navLinks.find(link => link.id === navId);
            if (!navLink) return;
            
            // å­˜å‚¨å½“å‰ç¼–è¾‘çš„é“¾æ¥ID
            currentEditingLinkId = navId;
            
            // å¡«å……å¯¹è¯æ¡†è¡¨å•
            document.getElementById('edit-link-name').value = navLink.name;
            document.getElementById('edit-link-url').value = navLink.url;
            
            // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
            const categorySelector = document.getElementById('edit-link-category');
            categorySelector.innerHTML = '';
            
            // æ·»åŠ é»˜è®¤é€‰é¡¹
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'æœªåˆ†ç±»';
            categorySelector.appendChild(defaultOption);
            
            // æ·»åŠ åˆ†ç±»é€‰é¡¹
            window.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.icon} ${category.name}`;
                if (navLink.categoryId === category.id) {
                    option.selected = true;
                }
                categorySelector.appendChild(option);
            });
            
            // æ˜¾ç¤ºå¯¹è¯æ¡†
            document.getElementById('edit-link-dialog').classList.add('active');
        }

        // å…³é—­ç¼–è¾‘å¯¼èˆªé“¾æ¥å¯¹è¯æ¡†
        function closeEditLinkDialog() {
            // æ¸…ç©ºå½“å‰ç¼–è¾‘çš„é“¾æ¥ID
            currentEditingLinkId = null;
            
            // éšè—å¯¹è¯æ¡†
            document.getElementById('edit-link-dialog').classList.remove('active');
        }

        // ä¿å­˜å¯¼èˆªé“¾æ¥ç¼–è¾‘
        function saveLinkEdit() {
            if (!currentEditingLinkId) return;
            
            const navLink = window.navLinks.find(link => link.id === currentEditingLinkId);
            if (!navLink) {
                closeEditLinkDialog();
                return;
            }
            
            const newName = document.getElementById('edit-link-name').value.trim();
            const newUrl = document.getElementById('edit-link-url').value.trim();
            const newCategoryId = document.getElementById('edit-link-category').value;
            
            if (!newName || !newUrl) {
                showToast('å¯¼èˆªåç§°å’Œé“¾æ¥åœ°å€ä¸èƒ½ä¸ºç©ºï¼', 'error');
                return;
            }
            
            // æ›´æ–°é“¾æ¥ä¿¡æ¯
            navLink.name = newName;
            navLink.url = newUrl;
            
            // æ›´æ–°åˆ†ç±»ä¿¡æ¯ï¼ˆå¦‚æœé€‰æ‹©äº†åˆ†ç±»ï¼‰
            if (newCategoryId) {
                navLink.categoryId = newCategoryId;
            } else {
                delete navLink.categoryId;
            }
            
            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveNavLinks();
            renderSidebarNav();
            renderSettingsNavList();
            
            // å…³é—­å¯¹è¯æ¡†
            closeEditLinkDialog();
            
            showToast('å¯¼èˆªé“¾æ¥ç¼–è¾‘æˆåŠŸï¼', 'success');
        }

        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        function showConfirmDialog(message, callback) {
            // è®¾ç½®ç¡®è®¤æ¶ˆæ¯
            document.getElementById('confirm-message').textContent = message;
            
            // è®¾ç½®å›è°ƒå‡½æ•°
            confirmDialogCallback = callback;
            
            // æ˜¾ç¤ºå¯¹è¯æ¡†
            document.getElementById('confirm-dialog').classList.add('active');
        }

        // å…³é—­ç¡®è®¤å¯¹è¯æ¡†
        function closeConfirmDialog() {
            // æ¸…ç©ºå›è°ƒå‡½æ•°
            confirmDialogCallback = null;
            
            // éšè—å¯¹è¯æ¡†
            document.getElementById('confirm-dialog').classList.remove('active');
        }

        // æ‰§è¡Œç¡®è®¤å¯¹è¯æ¡†å›è°ƒ
        function executeConfirmCallback() {
            if (typeof confirmDialogCallback === 'function') {
                confirmDialogCallback();
            }
            closeConfirmDialog();
        }

        // ä¸ºæ‰€æœ‰iframeæ·»åŠ å‰ªè´´æ¿ç›‘å¬
        function setupIframeClipboardListeners() {
            // è·å–æ‰€æœ‰iframe
            const iframes = document.querySelectorAll('iframe');
            
            iframes.forEach(iframe => {
                try {
                    // ä¸ºiframeçš„contentDocumentæ·»åŠ pasteäº‹ä»¶ç›‘å¬å™¨
                    iframe.contentDocument.addEventListener('paste', function(e) {
                        const clipboardData = e.clipboardData || window.clipboardData;
                        const text = clipboardData.getData('text');
                        
                        if (text) {
                            addToClipboardHistory(text);
                        }
                    });
                } catch (error) {
                    // å¿½ç•¥è·¨åŸŸiframeçš„é”™è¯¯
                    console.log('æ— æ³•ä¸ºiframeæ·»åŠ å‰ªè´´æ¿ç›‘å¬:', error.message);
                }
            });
        }

        // æ‰“å¼€æ·»åŠ åˆ†ç±»å¯¹è¯æ¡†
        function openAddCategoryDialog() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('add-category-name').value = '';
            document.getElementById('add-category-icon').value = '';
            
            // æ˜¾ç¤ºå¯¹è¯æ¡†
            document.getElementById('add-category-dialog').classList.add('active');
        }

        // å…³é—­æ·»åŠ åˆ†ç±»å¯¹è¯æ¡†
        function closeAddCategoryDialog() {
            // éšè—å¯¹è¯æ¡†
            document.getElementById('add-category-dialog').classList.remove('active');
        }

        // ä¿å­˜æ–°åˆ†ç±»
        function saveNewCategory() {
            const categoryName = document.getElementById('add-category-name').value.trim();
            const categoryIcon = document.getElementById('add-category-icon').value.trim();
            
            if (!categoryName) {
                showToast('è¯·è¾“å…¥åˆ†ç±»åç§°ï¼', 'error');
                return;
            }

            // ç”Ÿæˆå”¯ä¸€ID
            const categoryId = 'cat_' + Date.now();
            
            // æ·»åŠ åˆ°åˆ†ç±»åˆ—è¡¨
            window.categories.push({
                id: categoryId,
                name: categoryName,
                icon: categoryIcon || 'ğŸ“'
            });

            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveCategories();
            renderSidebarNav();
            renderSettingsCategoryList();
            updateCategorySelector();
            
            // å…³é—­å¯¹è¯æ¡†
            closeAddCategoryDialog();
            
            showToast('åˆ†ç±»æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // æ‰“å¼€æ·»åŠ å¯¼èˆªé“¾æ¥å¯¹è¯æ¡†
        function openAddLinkDialog() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('add-link-name').value = '';
            document.getElementById('add-link-url').value = '';
            
            // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
            const categorySelector = document.getElementById('add-link-category');
            categorySelector.innerHTML = '';
            
            // æ·»åŠ é»˜è®¤é€‰é¡¹
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'é€‰æ‹©åˆ†ç±»';
            categorySelector.appendChild(defaultOption);
            
            // æ·»åŠ åˆ†ç±»é€‰é¡¹
            window.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.icon} ${category.name}`;
                categorySelector.appendChild(option);
            });
            
            // æ˜¾ç¤ºå¯¹è¯æ¡†
            document.getElementById('add-link-dialog').classList.add('active');
        }

        // å…³é—­æ·»åŠ å¯¼èˆªé“¾æ¥å¯¹è¯æ¡†
        function closeAddLinkDialog() {
            // éšè—å¯¹è¯æ¡†
            document.getElementById('add-link-dialog').classList.remove('active');
        }

        // ä¿å­˜æ–°å¯¼èˆªé“¾æ¥
        function saveNewLink() {
            const navName = document.getElementById('add-link-name').value.trim();
            const navUrl = document.getElementById('add-link-url').value.trim();
            const categoryId = document.getElementById('add-link-category').value;
            
            if (!navName || !navUrl) {
                showToast('è¯·è¾“å…¥å¯¼èˆªåç§°å’Œé“¾æ¥ï¼', 'error');
                return;
            }

            // ç”Ÿæˆå”¯ä¸€ID
            const navId = 'nav_' + Date.now();
            
            // æ·»åŠ åˆ°å¯¼èˆªé“¾æ¥
            const newNavLink = {
                id: navId,
                name: navName,
                url: navUrl
            };
            
            // æ·»åŠ åˆ†ç±»ä¿¡æ¯ï¼ˆå¦‚æœé€‰æ‹©äº†åˆ†ç±»ï¼‰
            if (categoryId) {
                newNavLink.categoryId = categoryId;
            }
            
            window.navLinks.push(newNavLink);

            // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
            saveNavLinks();
            renderSidebarNav();
            renderSettingsNavList();
            
            // å…³é—­å¯¹è¯æ¡†
            closeAddLinkDialog();
            
            showToast('å¯¼èˆªé“¾æ¥æ·»åŠ æˆåŠŸï¼', 'success');
        }

        // åˆ é™¤åˆ†ç±»
        function deleteCategory(categoryId) {
            // è‡³å°‘ä¿ç•™ä¸€ä¸ªåˆ†ç±»
            if (window.categories.length <= 1) {
                showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªåˆ†ç±»ï¼', 'error');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰é“¾æ¥å±äºè¯¥åˆ†ç±»
            const linksInCategory = window.navLinks.filter(link => link.categoryId === categoryId);
            
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            showConfirmDialog(
                linksInCategory.length > 0 
                    ? 'è¯¥åˆ†ç±»ä¸‹è¿˜æœ‰é“¾æ¥ï¼Œåˆ é™¤åè¿™äº›é“¾æ¥å°†å˜ä¸ºæœªåˆ†ç±»ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ' 
                    : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿ',
                function() {
                    // æ‰§è¡Œåˆ é™¤æ“ä½œ
                    if (linksInCategory.length > 0) {
                        // å°†è¯¥åˆ†ç±»ä¸‹çš„é“¾æ¥è®¾ä¸ºæœªåˆ†ç±»
                        linksInCategory.forEach(link => {
                            delete link.categoryId;
                        });
                        saveNavLinks();
                    }

                    // ä»åˆ†ç±»åˆ—è¡¨ä¸­ç§»é™¤
                    window.categories = window.categories.filter(cat => cat.id !== categoryId);
                    
                    // ä¿å­˜å¹¶é‡æ–°æ¸²æŸ“
                    saveCategories();
                    renderSidebarNav();
                    renderSettingsCategoryList();
                    updateCategorySelector();
                    renderSettingsNavList();
                    
                    showToast('åˆ†ç±»åˆ é™¤æˆåŠŸï¼', 'success');
                }
            );
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            // è·å–å‰ªè´´æ¿é™åˆ¶å€¼
            const clipboardLimit = parseInt(document.getElementById('settings-clipboard-limit').value) || 100;
            window.appConfig.clipboardLimit = clipboardLimit;
            
            // ä¿å­˜é…ç½®
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.CONFIG), JSON.stringify(window.appConfig));
            
            // è£å‰ªå‰ªè´´æ¿å†å²
            trimClipboardHistory();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            const successMsg = document.getElementById('settings-success-message');
            successMsg.style.display = 'block';
            
            // 3ç§’åéšè—æç¤º
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
            
            showToast('è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'success');
        }

        // ========== é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ ==========
        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            // å‡†å¤‡å¯¼å‡ºçš„æ•°æ®ï¼ˆæ–°å¢schemaVersionå­—æ®µï¼‰
            const exportData = {
                schemaVersion: SCHEMA_CONSTANTS.CURRENT_VERSION, // 3. æ–°å¢schemaç‰ˆæœ¬å­—æ®µ
                version: '1.0',
                exportTime: new Date().toLocaleString(),
                categories: window.categories,
                navLinks: window.navLinks,
                config: window.appConfig
            };
            
            // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²å¹¶æ ¼å¼åŒ–
            const jsonStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            
            // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŸºäºå½“å‰å·¥å…·åç§°+æ—¶é—´ï¼‰
            const prefix = getUniqueStoragePrefix().replace('webtool_', '').replace('_', '');
            const fileName = `webtool_config_${prefix}_${new Date().getTime()}.json`;
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            
            // æ¸…ç†
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
            
            // 2. ä½¿ç”¨toastæ›¿ä»£alert
            showToast('é…ç½®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½åˆ°æœ¬åœ°ã€‚', 'success');
        }

        // å¤„ç†é…ç½®å¯¼å…¥
        function handleConfigImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„JSONé…ç½®æ–‡ä»¶ï¼', 'error');
                event.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                return;
            }
            
            // ç¡®è®¤è¦†ç›–ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†ï¼‰
            showConfirmDialog(
                'å¯¼å…¥é…ç½®ä¼šè¦†ç›–å½“å‰æ‰€æœ‰å¯¼èˆªé“¾æ¥å’Œå‰ªè´´æ¿è®¾ç½®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ',
                function() {
                    // è¯»å–æ–‡ä»¶å†…å®¹
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importData = JSON.parse(e.target.result);
                            
                            // 3. æ£€æŸ¥schemaç‰ˆæœ¬
                            if (!importData.schemaVersion) {
                                throw new Error('é…ç½®æ–‡ä»¶ç¼ºå°‘schemaç‰ˆæœ¬ä¿¡æ¯ï¼Œæ— æ³•å¯¼å…¥');
                            }
                            
                            if (!SCHEMA_CONSTANTS.SUPPORTED_VERSIONS.includes(importData.schemaVersion)) {
                                throw new Error(`ä¸æ”¯æŒçš„schemaç‰ˆæœ¬ï¼š${importData.schemaVersion}ï¼Œå½“å‰æ”¯æŒçš„ç‰ˆæœ¬ä¸ºï¼š${SCHEMA_CONSTANTS.SUPPORTED_VERSIONS.join(', ')}`);
                            }
                            
                            // éªŒè¯å¯¼å…¥æ•°æ®æ ¼å¼
                            if (!importData.navLinks || !Array.isArray(importData.navLinks)) {
                                throw new Error('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œç¼ºå°‘å¯¼èˆªé“¾æ¥æ•°æ®');
                            }
                            
                            if (!importData.config) {
                                throw new Error('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œç¼ºå°‘é…ç½®æ•°æ®');
                            }
                            
                            // åº”ç”¨å¯¼å…¥çš„é…ç½®
                            if (importData.categories && Array.isArray(importData.categories)) {
                                window.categories = importData.categories;
                                saveCategories();
                            }
                            window.navLinks = importData.navLinks;
                            window.appConfig = importData.config;
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            saveNavLinks();
                            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.CONFIG), JSON.stringify(window.appConfig));
                            
                            // é‡ç½®æ¿€æ´»çš„Tabsï¼ˆåªä¿ç•™ç¬¬ä¸€ä¸ªå¯¼èˆªé“¾æ¥ï¼‰
                            window.activeTabs.clear();
                            if (window.navLinks.length > 0) {
                                const firstNav = window.navLinks[0];
                                window.activeTabs.set(firstNav.id, {
                                    name: firstNav.name,
                                    url: firstNav.url,
                                    id: firstNav.id
                                });
                            }
                            saveActiveTabs();
                            
                            // é‡æ–°æ¸²æŸ“ç•Œé¢
                            renderSidebarNav();
                            renderSettingsCategoryList();
                            updateCategorySelector();
                            renderSettingsNavList();
                            renderTabs(SETTINGS_TAB_ID);
                            
                            // 2. ä½¿ç”¨toastæ›¿ä»£alert
                            showToast('é…ç½®å¯¼å…¥æˆåŠŸï¼å·²åº”ç”¨æ–°çš„å¯¼èˆªé“¾æ¥å’Œè®¾ç½®ã€‚', 'success');
                            
                        } catch (error) {
                            showToast(`é…ç½®å¯¼å…¥å¤±è´¥ï¼š${error.message}`, 'error');
                        } finally {
                            // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                            event.target.value = '';
                        }
                    };
                    
                    reader.readAsText(file);
                }
            );
            
            // å¦‚æœç”¨æˆ·å–æ¶ˆï¼Œæ¸…ç©ºæ–‡ä»¶é€‰æ‹©
            event.target.value = '';
            return;
        }

        // ========== å‰ªè´´æ¿ç›¸å…³å‡½æ•° ==========
        // ç›‘å¬å‰ªè´´æ¿
        function listenClipboard() {
            // ç›‘å¬ç²˜è´´äº‹ä»¶
            document.addEventListener('paste', function(e) {
                const clipboardData = e.clipboardData || window.clipboardData;
                const text = clipboardData.getData('text');
                
                if (text) {
                    addToClipboardHistory(text);
                }
            });
        }

        // æ·»åŠ åˆ°å‰ªè´´æ¿å†å²
        function addToClipboardHistory(text) {
            // å»é‡
            let history = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD)) || '[]');
            const isDuplicate = history.some(item => item.text === text);
            
            if (isDuplicate) return;

            // æ·»åŠ æ–°è®°å½•
            history.unshift({
                id: 'clip_' + Date.now(),
                text: text,
                time: new Date().toLocaleString()
            });

            // è£å‰ªåˆ°é…ç½®çš„æœ€å¤§æ¡æ•°
            history = history.slice(0, window.appConfig.clipboardLimit);
            
            // ä¿å­˜
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD), JSON.stringify(history));
            
            // é‡æ–°æ¸²æŸ“
            loadClipboardHistory();
        }

        // åŠ è½½å‰ªè´´æ¿å†å²
        function loadClipboardHistory() {
            const historyContainer = document.getElementById('clipboard-history');
            historyContainer.innerHTML = '';

            const history = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD)) || '[]');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">æš‚æ— å‰ªè´´æ¿è®°å½•</div>';
                return;
            }

            // æ¸²æŸ“æ¯æ¡è®°å½•
            history.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'clipboard-item';
                itemElement.dataset.clipId = item.id;
                itemElement.innerHTML = `
                    <div class="clipboard-content">
                        <div style="font-size:12px; color:#999; margin-bottom:3px;">${item.time}</div>
                        <div>${item.text}</div>
                    </div>
                    <div class="clipboard-actions">
                        <button class="clipboard-copy-btn" onclick="copyClipboardItem('${item.id}')">å¤åˆ¶</button>
                    </div>
                `;
                
                historyContainer.appendChild(itemElement);
            });
        }

        // å¤åˆ¶å‰ªè´´æ¿æ¡ç›®ï¼ˆç‚¹å‡»æŒ‰é’®è§¦å‘ï¼‰
        function copyClipboardItem(clipId) {
            const history = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD)) || '[]');
            const item = history.find(item => item.id === clipId);
            
            if (!item) return;
            
            // æ‰§è¡Œå¤åˆ¶
            navigator.clipboard.writeText(item.text).then(() => {
                // æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®å¹¶æ›´æ–°çŠ¶æ€
                const copyBtn = document.querySelector(`.clipboard-item[data-clip-id="${clipId}"] .clipboard-copy-btn`);
                const originalText = copyBtn.textContent;
                
                // æ›´æ–°æŒ‰é’®æ ·å¼å’Œæ–‡æœ¬
                copyBtn.textContent = 'å·²å¤åˆ¶';
                copyBtn.classList.add('success');
                
                // 1ç§’åæ¢å¤
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('success');
                }, 1000);
            });
        }

        // è£å‰ªå‰ªè´´æ¿å†å²
        function trimClipboardHistory() {
            const history = JSON.parse(localStorage.getItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD)) || '[]');
            const trimmedHistory = history.slice(0, window.appConfig.clipboardLimit);
            localStorage.setItem(getStorageKey(STORAGE_BASE_KEYS.CLIPBOARD), JSON.stringify(trimmedHistory));
            loadClipboardHistory();
        }

        // ========== 2. Toasté€šçŸ¥åŠŸèƒ½ ==========
        function showToast(message, type = 'info') {
            // åˆ›å»ºtoastå®¹å™¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }

            // åˆ›å»ºtoastå…ƒç´ 
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            // è®¾ç½®å›¾æ ‡
            let icon = '';
            switch(type) {
                case 'success':
                    icon = 'âœ…';
                    break;
                case 'error':
                    icon = 'âŒ';
                    break;
                case 'info':
                    icon = 'â„¹ï¸';
                    break;
            }
            
            toast.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;

            // æ·»åŠ åˆ°å®¹å™¨
            toastContainer.appendChild(toast);

            // è§¦å‘åŠ¨ç”»ï¼ˆå¼ºåˆ¶é‡ç»˜ï¼‰
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'scale(1)';
            }, 10);

            // 3ç§’åç§»é™¤
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
